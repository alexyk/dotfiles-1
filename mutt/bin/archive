#!/usr/bin/env rvm 2.1.0@skanev do ruby
message_id = nil
STDIN.each_line do |line|
  message_id = $1 if line =~ /^Message-ID: (.*?)$/
end

exit unless message_id

require 'maildir'
maildir = Maildir.new('/Users/aquarius/.mail/stefan-kanev-gmail/archive/')

message = maildir.list(:new).detect { |m| m.data[/^Message-ID: (.*?)$/, 1] == message_id }

exit unless message

message.process
message.seen!
